{"version":3,"sources":["droppedFileReader.js","index.js"],"names":["humanFileSize","size","i","Math","floor","log","round","pow","onFileDrop","e","callbackFn","preventDefault","reader","FileReader","dropArea","target","readAsText","dataTransfer","files","innerHTML","name","toString","start","Date","getTime","onload","event","elapsed","setTime","result","length","data","JSON","parse","err","dropFileArea","document","getElementById","ondragover","ondragend","ondrop","onGeojsonLoad","google","L","tileLayer","id","attribution","osm","baseMaps","leafletMap","map","center","zoom","layers","control","addTo","defaultLayerStyle","weight","color","opacity","fillColor","fill","radius","fillOpacity","highlightFeatureStyle","tileOptions","zIndex","maxZoom","indexMaxZoom","interactive","rendererFactory","canvas","tile","vectorTileLayerStyles","sliced","getFeatureId","f","properties","highlitedFeatures","highlightFeature","featureId","layer","style","setFeatureStyle","unHighlightFeature","resetFeatureStyle","console","remove","vectorGrid","slicer","on","targetFeatureId","forEach","push","similarity_objects","similarity"],"mappings":"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","file":"similar-objects-viewer.2c37e539.map","sourceRoot":"..","sourcesContent":["function humanFileSize(size) {\n  var i = Math.floor(Math.log(size) / Math.log(1024));\n  return Math.round(100 * (size / Math.pow(1024, i))) / 100 + ' ' + ['B', 'kB', 'MB', 'GB'][i];\n}\n\nfunction onFileDrop(e, callbackFn) {\n  e.preventDefault();\n\n  var reader = new FileReader();\n  var dropArea = e.target;\n\n\n  reader.readAsText(e.dataTransfer.files[0]);\n  dropArea.innerHTML += \"<br/>\";\n  dropArea.innerHTML += \"<br/>Loading... \" + e.dataTransfer.files[0].name.toString();\n  var start = new Date().getTime();\n  reader.onload = function (event) {\n    var elapsed = new Date().setTime(new Date().getTime() - start);\n    dropArea.innerHTML += \" \" + elapsed + \"ms\";\n    try {\n      dropArea.innerHTML += \"<br/>&nbsp;Parsing... \" + humanFileSize(event.target.result.length);\n      start = new Date().getTime();\n\n      var data = JSON.parse(event.target.result);\n      elapsed = new Date().setTime(new Date().getTime() - start);\n      dropArea.innerHTML += \" \" + elapsed + \"ms\";\n\n      callbackFn(data);\n\n    } catch (err) {\n      dropArea.innerHTML += \"<br/>&nbsp;Error: \" + err;\n    }\n  };\n};\n\nexport { onFileDrop };","import './styles/styles.scss'\nimport { onFileDrop } from './droppedFileReader'\n\nvar dropFileArea = document.getElementById('drop');\ndropFileArea.ondragover = function () { return false; };\ndropFileArea.ondragend = function () { return false; };\ndropFileArea.ondrop = (e) => onFileDrop(e, onGeojsonLoad);\n\n\nvar google = L.tileLayer(\"http://mt0.google.com/vt/lyrs=s&hl=en&x={x}&y={y}&z={z}&s=Ga\", {id: 0, attribution: false}),\n  osm = L.tileLayer(\"http://a.tile.openstreetmap.org/{z}/{x}/{y}.png\", {id: 1, attribution: false});\n\nvar baseMaps = {\n  \"Google\": google,\n  \"OSM\": osm\n};\nvar leafletMap = L.map('map', {\n  center: [58.623858, 49.666106],\n  zoom: 12,\n  layers: [google]\n});\n\nL.control.layers(baseMaps).addTo(leafletMap);\n\nvar defaultLayerStyle = {\n  weight: 2,\n  color: 'gray',\n  opacity: .5,\n  fillColor: 'lightgray',\n  fill: true,\n  radius: 6,\n  fillOpacity: 0.4\n};\n\nvar highlightFeatureStyle = {\n  weight: 2,\n  color: 'red',\n  opacity: .4,\n  fillColor: 'red',\n  fill: true,\n  radius: 6,\n  fillOpacity: 0.3\n};\n\nvar tileOptions = {\n  zIndex: 201,\n  maxZoom: 20,\n  indexMaxZoom: 0,\n  interactive: true,\n  rendererFactory: L.canvas.tile,\n  vectorTileLayerStyles: {\n    sliced: defaultLayerStyle\n  },\n  getFeatureId: function (f) {\n    return f.properties.id\n  },\n};\n\nvar tileLayer;\nvar highlitedFeatures = [];\n\nfunction highlightFeature({ featureId, layer = tileLayer, style = highlightFeatureStyle } = {}) {\n  layer.setFeatureStyle(featureId, style)\n}\n\nfunction unHighlightFeature(featureId, layer = tileLayer) {\n  layer.resetFeatureStyle(featureId)\n}\n\nfunction onGeojsonLoad(data) {\n  console.log('callback called with ', data);\n  if (tileLayer) {\n    tileLayer.remove();\n  }\n  tileLayer = L.vectorGrid.slicer(data, tileOptions).addTo(leafletMap);\n  tileLayer.on('click', function ({ layer }) {\n    var { id: targetFeatureId } = layer.properties;\n    console.log('was clicked on feature with id: ', targetFeatureId);\n    if (highlitedFeatures.length > 0) {\n      tileLayer.resetFeatureStyle(targetFeatureId);\n      highlitedFeatures.forEach((id) => unHighlightFeature(id));\n      highlitedFeatures = [];\n    }\n    highlitedFeatures.push(targetFeatureId);\n    highlightFeature({\n      featureId: targetFeatureId,\n      style: {\n        ...highlightFeatureStyle,\n        fillColor: 'yellow'\n      }\n    });\n    var { similarity_objects = [] } = layer.properties;\n    similarity_objects.forEach(({ id: featureId, similarity }) => {\n      highlitedFeatures.push(featureId);\n      highlightFeature({ featureId })\n    })\n  })\n}"]}