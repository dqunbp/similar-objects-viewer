{"version":3,"sources":["droppedFileToArea.js","droppedFileToMap.js","constants.js","index.js"],"names":["humanFileSize","size","i","Math","floor","log","round","pow","onFileDropArea","e","callbackFn","preventDefault","reader","FileReader","dropArea","target","readAsText","dataTransfer","files","innerHTML","name","toString","start","Date","getTime","onload","event","elapsed","setTime","result","length","data","JSON","parse","err","onFileDropMap","console","error","defaultLayerStyle","weight","color","opacity","fillColor","fill","radius","fillOpacity","highlightFeatureStyle","dropFileArea","document","getElementById","ondragover","ondragend","ondrop","onGeojsonLoad","google","L","tileLayer","id","attribution","osm","baseMaps","mapNode","leafletMap","map","center","zoom","layers","control","addTo","tileOptions","zIndex","maxZoom","indexMaxZoom","interactive","rendererFactory","canvas","tile","vectorTileLayerStyles","sliced","getFeatureId","f","properties","highlitedFeatures","highlightFeature","featureId","layer","style","setFeatureStyle","unHighlightFeature","resetFeatureStyle","addDataToMap","remove","vectorGrid","slicer","on","targetFeatureId","forEach","push","similarity_objects","similarity"],"mappings":"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","file":"similar-objects-viewer.b0f47430.map","sourceRoot":"..","sourcesContent":["function humanFileSize(size) {\n  var i = Math.floor(Math.log(size) / Math.log(1024));\n  return Math.round(100 * (size / Math.pow(1024, i))) / 100 + ' ' + ['B', 'kB', 'MB', 'GB'][i];\n}\n\nfunction onFileDropArea(e, callbackFn) {\n  e.preventDefault();\n\n  var reader = new FileReader();\n  var dropArea = e.target;\n\n  reader.readAsText(e.dataTransfer.files[0]);\n  dropArea.innerHTML += \"<br/>\";\n  dropArea.innerHTML += \"<br/>Loading... \" + e.dataTransfer.files[0].name.toString();\n  var start = new Date().getTime();\n  reader.onload = function (event) {\n    var elapsed = new Date().setTime(new Date().getTime() - start);\n    dropArea.innerHTML += \" \" + elapsed + \"ms\";\n    try {\n      dropArea.innerHTML += \"<br/>&nbsp;Parsing... \" + humanFileSize(event.target.result.length);\n      start = new Date().getTime();\n\n      var data = JSON.parse(event.target.result);\n      elapsed = new Date().setTime(new Date().getTime() - start);\n      dropArea.innerHTML += \" \" + elapsed + \"ms\";\n\n      callbackFn(data);\n\n    } catch (err) {\n      dropArea.innerHTML += \"<br/>&nbsp;Error: \" + err;\n    }\n  };\n};\n\nexport { onFileDropArea };","function onFileDropMap(e, callbackFn) {\n  e.preventDefault();\n\n  var reader = new FileReader();\n  var dropArea = e.target;\n\n  reader.readAsText(e.dataTransfer.files[0]);\n  reader.onload = function (event) {\n    try {\n      var data = JSON.parse(event.target.result);\n      callbackFn(data);\n\n    } catch (err) {\n      console.error('Loading file error', err)\n    }\n  };\n};\n\nexport { onFileDropMap };","var defaultLayerStyle = {\n  weight: 2,\n  color: 'gray',\n  opacity: .5,\n  fillColor: 'lightgray',\n  fill: true,\n  radius: 6,\n  fillOpacity: 0.4\n};\n\nvar highlightFeatureStyle = {\n  weight: 2,\n  color: 'red',\n  opacity: .4,\n  fillColor: 'red',\n  fill: true,\n  radius: 6,\n  fillOpacity: 0.3\n};\n\nexport { defaultLayerStyle, highlightFeatureStyle };","import './styles/styles.scss';\nimport { onFileDropArea } from './droppedFileToArea';\nimport { onFileDropMap } from './droppedFileToMap';\nimport { defaultLayerStyle, highlightFeatureStyle } from './constants';\n\nvar dropFileArea = document.getElementById('drop');\ndropFileArea.ondragover = function () { return false; };\ndropFileArea.ondragend = function () { return false; };\ndropFileArea.ondrop = (e) => onFileDropArea(e, onGeojsonLoad);\n\n\nvar google = L.tileLayer(\"http://mt0.google.com/vt/lyrs=s&hl=en&x={x}&y={y}&z={z}&s=Ga\", { id: 0, attribution: false }),\n  osm = L.tileLayer(\"http://a.tile.openstreetmap.org/{z}/{x}/{y}.png\", { id: 1, attribution: false });\n\nvar baseMaps = {\n  \"Google\": google,\n  \"OSM\": osm\n};\n\nvar mapNode = document.getElementById('map');\nvar leafletMap = L.map(mapNode, {\n  center: [58.623858, 49.666106],\n  zoom: 12,\n  layers: [google]\n});\n\nL.control.layers(baseMaps).addTo(leafletMap);\n\nvar tileOptions = {\n  zIndex: 201,\n  maxZoom: 20,\n  indexMaxZoom: 0,\n  interactive: true,\n  rendererFactory: L.canvas.tile,\n  vectorTileLayerStyles: {\n    sliced: defaultLayerStyle\n  },\n  getFeatureId: function (f) {\n    return f.properties.id\n  },\n};\n\nvar tileLayer;\nvar highlitedFeatures = [];\n\nfunction highlightFeature({ featureId, layer = tileLayer, style = highlightFeatureStyle } = {}) {\n  layer.setFeatureStyle(featureId, style)\n}\n\nfunction unHighlightFeature(featureId, layer = tileLayer) {\n  layer.resetFeatureStyle(featureId)\n}\n\n\nfunction addDataToMap(data) {\n  if (tileLayer) {\n    tileLayer.remove();\n  }\n  tileLayer = L.vectorGrid.slicer(data, tileOptions).addTo(leafletMap);\n  tileLayer.on('click', function ({ layer }) {\n    var { id: targetFeatureId } = layer.properties;\n    console.log('was clicked on feature with id: ', targetFeatureId);\n    if (highlitedFeatures.length > 0) {\n      tileLayer.resetFeatureStyle(targetFeatureId);\n      highlitedFeatures.forEach((id) => unHighlightFeature(id));\n      highlitedFeatures = [];\n    }\n    highlitedFeatures.push(targetFeatureId);\n    highlightFeature({\n      featureId: targetFeatureId,\n      style: {\n        ...highlightFeatureStyle,\n        fillColor: 'yellow'\n      }\n    });\n    var { similarity_objects = [] } = layer.properties;\n    similarity_objects.forEach(({ id: featureId, similarity }) => {\n      highlitedFeatures.push(featureId);\n      highlightFeature({ featureId })\n    })\n  })\n}\n\nfunction onGeojsonLoad(data) {\n  console.log('callback called with ', data);\n  addDataToMap(data);\n}\n\n\nmapNode.ondragover = function () { return false; };\nmapNode.ondragend = function () { return false; };\nmapNode.ondrop = (e) => { onFileDropMap(e, onGeojsonLoad); }\n\n// import { json } from 'd3-fetch'\n// var jsonData = require('./other/sim.geojson')\n// leafletMap.on('load',\n//   json(jsonData).then((data) => { addDataToMap(data); })\n// )"]}